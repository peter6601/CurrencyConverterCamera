# 價格偵測顯示方式更新

## 🎯 更新內容

將轉換後的金額**直接顯示在綠色偵測框的正上方**，讓使用者即時看到轉換結果。

## 📱 新的顯示方式

### 之前 ❌
```
┌─────────────────────────┐
│   相機畫面                │
│                          │
│   ┌──────────┐           │
│   │ 1000     │ 85%       │  ← 只顯示偵測到的數字和信心度
│   └──────────┘           │
│                          │
├─────────────────────────┤
│ Detection Result         │  ← 轉換結果在底部
│ Detected: ¥1000          │
│ Converted: NT$220        │
└─────────────────────────┘
```

### 現在 ✅
```
┌─────────────────────────┐
│   相機畫面                │
│                          │
│   ┌─────────────┐        │
│   │ NT$ 220.00  │ ⬅️ 轉換後的金額（綠色大字）
│   └─────────────┘        │
│   ┌──────────┐           │
│   │¥1000     │           │  ← 綠色偵測框
│   └──────────┘           │
│                          │
└─────────────────────────┘
```

## 🎨 UI 設計細節

### 1. 轉換金額顯示（框的正上方）

**位置：** 偵測框正上方，向上偏移 8pt

**樣式：**
- 📦 半透明黑色背景（opacity: 0.8）
- 🟢 綠色粗體文字
- 📏 字體大小：16pt, weight: bold
- 🔲 圓角背景：8pt
- 📐 尺寸：120x30

**格式：**
```swift
"NT$ 220.00"  // 顯示到小數點後兩位
```

### 2. 原始偵測值（框的左上角）

**位置：** 綠色框內的左上角

**樣式：**
- ⚪ 白色小字
- 📏 字體大小：caption2
- 📍 位置：(x+5, y+5)

**格式：**
```swift
"¥1000"  // 偵測到的原始金額
```

### 3. 偵測框

**樣式：**
- 線條寬度：3pt（加粗）
- 顏色：根據信心度
  - 🟢 綠色：>= 85%
  - 🟡 黃色：70% - 84%
  - 🔴 紅色：< 70%

## 🔧 技術實作

### DetectionOverlayView 更新

新增兩個參數：
```swift
struct DetectionOverlayView: View {
    let frame: CameraFrame
    let detectedNumbers: [DetectedNumber]
    let conversionResult: ConversionResult?  // ✨ 新增
    let currencySettings: CurrencySettings?   // ✨ 新增
}
```

### 計算轉換金額

對每個偵測到的數字進行轉換：
```swift
let detectedValue = detection.value
let convertedValue = detectedValue * exchangeRate
let convertedText = String(format: "NT$ %.2f", convertedValue)
```

### 繪製背景框

```swift
let backgroundRect = CGRect(
    x: textX,
    y: textY,  // 框的上方
    width: 120,
    height: 30
)

context.fill(
    Path(roundedRect: backgroundRect, cornerRadius: 8),
    with: .color(.black.opacity(0.8))
)
```

### 繪製轉換金額

```swift
context.draw(
    Text(convertedText)
        .font(.system(size: 16, weight: .bold))
        .foregroundColor(.green),
    at: center,
    anchor: .center
)
```

## 📊 視覺層次

從上到下：
1. **轉換金額**（最顯眼）- 綠色大字
2. **偵測框**（中等）- 綠色邊框
3. **原始金額**（次要）- 白色小字
4. **信心度**（可選）- 只在沒有轉換時顯示

## 🎯 使用者體驗

### 即時轉換
- 使用者看到任何數字時，立即知道轉換後的金額
- 不需要看底部的結果區域
- 可以快速掃描多個價格

### 清晰對比
- 綠色轉換金額 vs 白色原始金額
- 清楚知道哪個是最終金額

### 視覺引導
```
👁️ 使用者視線流程：
1. 看到綠色框（吸引注意）
2. 看到框上方的綠色數字（轉換結果）
3. 確認框內的原始數字（如需要）
```

## 📐 座標計算

### 轉換金額位置
```swift
// 框的中心 X 座標
let centerX = x + width / 2

// 文字框位置（居中對齊）
let textX = centerX - textSize.width / 2

// 在框上方，留 8pt 間距
let textY = y - textSize.height - 8
```

### 原始金額位置
```swift
// 框的左上角，內縮 5pt
let originalX = x + 5
let originalY = y + 5
```

## 🔄 更新的檔案

### DetectionOverlayView.swift
- ✅ 新增 `conversionResult` 參數
- ✅ 新增 `currencySettings` 參數
- ✅ 計算並顯示轉換金額
- ✅ 繪製半透明背景框
- ✅ 顯示原始金額在框內

### CameraView.swift
- ✅ 傳遞 `viewModel.latestResult`
- ✅ 傳遞 `appState.currencySettings`

## 🎬 動態效果

### 當偵測到價格時：
1. 綠色框出現（線條動畫）
2. 轉換金額淡入（在框上方）
3. 原始金額顯示（在框內）

### 當失去偵測時：
1. 框和文字同時淡出

## 💡 後續可優化

### 1. 動畫效果
```swift
.animation(.easeInOut(duration: 0.2), value: detectedNumbers)
```

### 2. 多個偵測
如果畫面中有多個數字：
- 每個都顯示自己的轉換結果
- 使用不同顏色區分（如果需要）

### 3. 文字陰影
讓文字更清晰：
```swift
.shadow(color: .black, radius: 2, x: 0, y: 0)
```

### 4. 貨幣符號
根據設定的貨幣顯示：
```swift
// 原始：¥1000 (JPY)
// 轉換：NT$ 220 (TWD)
// 或：$ 220 (USD)
```

## 📸 範例場景

### 場景 1：日本餐廳菜單
```
相機對準 "ラーメン ¥1200"

顯示：
    ┌──────────┐
    │NT$ 264.00│  ← 綠色背景框
    └──────────┘
    ┌──────────┐
    │¥1200     │  ← 綠色偵測框
    └──────────┘
```

### 場景 2：商店價格標籤
```
相機對準 "¥580"

顯示：
    ┌──────────┐
    │NT$ 127.60│
    └──────────┘
    ┌──────────┐
    │¥580      │
    └──────────┘
```

### 場景 3：收據
```
相機對準多行金額：
¥850
¥1200
¥350

顯示：
    ┌──────────┐     ┌──────────┐     ┌──────────┐
    │NT$ 187.00│     │NT$ 264.00│     │NT$ 77.00 │
    └──────────┘     └──────────┘     └──────────┘
    ┌──────────┐     ┌──────────┐     ┌──────────┐
    │¥850      │     │¥1200     │     │¥350      │
    └──────────┘     └──────────┘     └──────────┘
```

## ✅ 測試檢查清單

- [ ] 轉換金額顯示在框的正上方
- [ ] 金額顯示為綠色粗體
- [ ] 背景是半透明黑色
- [ ] 原始金額顯示在框的左上角
- [ ] 綠色框線條加粗（3pt）
- [ ] 多個數字時，每個都有轉換顯示
- [ ] 文字大小和位置合適
- [ ] 在不同螢幕尺寸下顯示正常

## 🎉 結果

使用者現在可以：
- ✅ 即時看到轉換後的金額
- ✅ 清楚區分原始價格和轉換結果
- ✅ 快速掃描多個價格
- ✅ 不需要看底部的結果區域

視覺化的顯示讓價格轉換變得更直觀和高效！
